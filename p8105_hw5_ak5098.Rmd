---
title: "Homework 5"
output: html_document
date: "2024-11-05"
---


Loading packages
```{r}
library(tidyverse)
library(dplyr)
library(purrr)
library(broom)
```


##PROBLEM 2
```{r}
#writing function
sim_mean_sd = function(mu, iterations = 5000) {
  replicate(iterations, {
    sim_result = rnorm(n=30, mean = mu, sd = 5)
    t_test = t.test(sim_result, mu = 0)
    broom::tidy(t_test)
  }, simplify=FALSE) %>% 
    bind_rows() %>% 
    mutate(mu = mu)
}

mu_values = c(1:6)

results = map_dfr(mu_values, sim_mean_sd)

#########################################################

sim_mean_sd = function(n=30, mu = 0, sigma = 5) {
  sim_data = tibble(x = rnorm(n, mean = mu, sd = sigma),)
  return(sim_data)
}

results = data.frame(mu = numeric(), mu_hat = numeric(), p_value = numeric())
for (mu in 0:6) {
  for (i in 1:5000) {
    sim_result = sim_mean_sd(n=30, mu = mu, sigma = 5)
    t_test = t.test(sim_result$x, mu=0, conf.level = 0.95)
    t_test_result = broom::tidy(t_test)
    results = bind_rows(results, data.frame(
      mu = mu,
      mu_hat = t_test_result$estimate,
      p_value = t_test_result$p.value))
        }}


#make a plot with power on the y-axis and true mu on the x-axis
power_data = results %>% group_by(mu) %>% summarize(power = mean(p_value < 0.05))
power_data %>% 
  ggplot(aes(x=mu, y=power)) +
  geom_point() +
  geom_line()

```

Effect size vs. power: power increases as mu increases, showing they have a positive relationship.The relationship between effect size and power is inversely exponential; there is a sharp increase in power for mu=1 through mu=3, and there is a gradual plateau after that. 

```{r}
#plot showing average vs true mu
plot2 = results %>% 
  group_by(mu) %>% 
  mutate(avg_mu_hat = mean(mu_hat)) %>% 
  ggplot(aes(x = mu, y = avg_mu_hat)) + geom_point() + geom_line()



#plot showing avg mu in rejected null vs true mu
mu_rejected = results %>%
  group_by(mu) %>%
  filter(p_value < 0.05) %>% 
  summarize(avg_rejected = mean(mu_hat, na.rm=TRUE))

plot3 = mu_rejected %>% 
  ggplot(aes(x=mu, y=avg_rejected)) +
  geom_point() +
  geom_line() 
```
The sample average is not equal to the true mu. 


PROBLEM 3
```{r}
homicide = read_csv("homicide-data.csv")

homicide = homicide %>% mutate(city_state = str_c(city, state, sep = ", ")) 

#adding total homicides and unsolved homicides
homicide_new = homicide %>% 
  group_by(city_state) %>% 
  summarize(
    total_homicides = n(),
    unsolved_homicides = sum(disposition %in% c("Closed without arrest", "Open/No arrest"))
  )


#prop.test for Baltimore
baltimore_data = homicide_new %>%
  filter(city_state == "Baltimore, MD") %>% 
  select(unsolved_homicides, total_homicides)

baltimore_prop_test = prop.test(
  x = baltimore_data %>% pull(unsolved_homicides),
  n = baltimore_data %>% pull(total_homicides)
  ) %>% broom::tidy() %>% 
  select(estimate, conf.low, conf.high)

#prop.test for all cities
city_prop_test = homicide %>% 
  group_by(city_state) %>% 
  summarize(
    results = list(prop.test(
      x = sum(disposition %in% c("Closed without arrest", "Open/No arrest")),
      n = n()
    ))
  ) %>% 
  mutate(
    tidy_results = map(results, broom::tidy)
  ) %>% 
  unnest(cols=tidy_results) %>% 
  select(city_state, estimate, conf.low, conf.high)

#plot
city_prop_test = city_prop_test %>% 
  arrange(estimate) %>% 
  mutate(city_state = factor(city_state, levels = city_state))

city_prop_plot = city_prop_test %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width=0.1) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(y = "Prop Test Estimate", x = "City")

```

Raw data: 12 columns and 52,179 observations. Each homicide has a unique ID, as well as information about the victim such as race, age and sex. The location of the homicide is described through city, state, latitude andlongitude. The disposition is also included.